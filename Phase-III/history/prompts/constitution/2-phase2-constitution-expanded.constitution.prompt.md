---
id: 2
title: Phase 2 Constitution Expanded
stage: constitution
date: 2026-02-01
surface: agent
model: claude-haiku-4-5-20251001
feature: none
branch: master
user: user
command: /sp.constitution
labels: ["constitution", "governance", "spec-first", "phase2", "monorepo", "security", "architecture"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
  - .specify/memory/constitution.md
  - history/prompts/constitution/2-phase2-constitution-expanded.constitution.prompt.md
tests:
  - null
---

## Prompt

You are tasked with authoring a detailed Markdown Constitution for Phase 2 of the "Evolution of Todo" hackathon project, transforming the console app into a multi-user full-stack web application with persistent storage and authentication.

Incorporate the following Core Principles and Standards from the project's governance framework:

1. **Spec-First Development:**
   - No manual coding allowed; all code must be generated by Claude Code.
   - Every code line must reference a Task ID and Spec section for traceability.
   - Follow the mandatory Specify ‚Üí Plan ‚Üí Tasks ‚Üí Implement workflow strictly.

2. **Progressive Evolution Architecture:**
   - This phase is part of a 5-phase sequential evolution (Console ‚Üí Web ‚Üí AI Chatbot ‚Üí Local K8s ‚Üí Cloud K8s).
   - Maintain backward compatibility and build upon previous phases.

3. **Clean Architecture & Stateless Services:**
   - Separate concerns clearly (models, services, API, infrastructure).
   - Backend must be stateless with database-persisted state.

4. **Security-First Implementation:**
   - Use JWT authentication with Better Auth, enforcing endpoint protection and user data isolation.
   - Validate inputs using Pydantic models, never store or transmit plain-text secrets.

5. **Test-Driven Development & Quality Gates:**
   - Ensure minimum 70% test coverage including unit, integration, and contract tests.
   - Use strict typing (Python type hints, strict TypeScript mode).
   - Code must pass Ruff (Python) and ESLint (JS/TS) linting.

6. **Monorepo Structure & Documentation Standards:**
   - Organize code and specs within frontend/, backend/, specs/, and helm/ folders.
   - Maintain CLAUDE.md files at root, frontend, and backend levels to guide Claude Code.
   - Use specs-history/ folder to track spec iterations.

7. **Feature Requirements & Constraints:**
   - Implement all Basic Level task CRUD and completion features.
   - Follow technology stack constraints: Next.js 16+ (App Router), FastAPI, SQLModel, Neon PostgreSQL, Better Auth with JWT.
   - Secure all API endpoints with JWT tokens passed in Authorization headers.
   - Enforce user data isolation: users only access their own tasks.

8. **API Conventions:**
   - RESTful API under /api prefix with JSON request/response format.
   - Include detailed endpoint specs with parameters, schemas, and error handling (401 Unauthorized, 404 Not Found, etc.).

9. **Database Conventions:**
   - Define users, tasks tables with appropriate indexes and relationships via SQLModel.

10. **Workflow Enforcement:**
    - No code generation without corresponding task specs.
    - Single source of truth is the specification documents.
    - Use Spec-Kit Plus in monorepo structure with phase-specific features as configured in .spec-kit/config.yaml.

11. **External Context Integration:**
    - When Claude Code needs latest or missing context, it should connect securely to the "context7" server to fetch updated specs or environment data.
    - Document any externally fetched context in generated code comments for traceability.

12. **Summary Checklist:**
    - Deliver frontend UI components and pages implementing task management and authentication flows.
    - Deliver backend API with JWT verification middleware, database models, and error handling.
    - Complete spec files organized under /specs/ per monorepo conventions.
    - Ensure CLAUDE.md files guide the Spec-Driven Development workflow effectively.

Use clear Markdown headings, lists, and tables. The Constitution must be thorough and precise, enabling Claude Code to generate all Phase 2 code without manual coding.

Conclude with notes on spec file organization, monorepo structure, and quality standards.

## Response snapshot

Constitutional amendment completed. Version bumped from 1.0.0 ‚Üí 2.0.0 (MAJOR version: substantial expansion from 7 to 12 principles, addition of Progressive Evolution architecture, API/DB conventions, Workflow Enforcement, External Context Integration, and comprehensive Quality Checklist).

**Core Changes:**

- **Principles Expanded**: From 7 to 12 core principles covering full Phase 2 scope
- **New Principles Added**:
  - Principle 2: Progressive Evolution Architecture (5-phase roadmap, backward compatibility)
  - Principle 8: API Conventions (RESTful /api endpoints, standard response formats, status codes, error taxonomy)
  - Principle 9: Database Conventions (SQLModel, indexes, foreign keys, migrations)
  - Principle 10: Workflow Enforcement (spec-first workflow, traceability, single source of truth)
  - Principle 11: External Context Integration (context7 MCP for framework docs)
  - Principle 12: Quality Standards & Deliverables Checklist (frontend/backend/spec deliverables, pre-release gates)

- **Expanded Sections**:
  - Principle 1 (Spec-First): Added traceability comment examples, workflow clarification
  - Principle 3 (Clean Architecture): Detailed architectural layers, stateless backend guarantee
  - Principle 4 (Security-First): JWT token claims, data isolation enforcement, secret management details
  - Principle 5 (Test-Driven): Coverage requirements, strict typing details, linting enforcement
  - Principle 6 (Monorepo): Complete directory tree, CLAUDE.md guardian pattern, spec file organization
  - Principle 7 (Feature Requirements): Technology stack table, endpoint security, data isolation examples

- **New Content**:
  - Detailed endpoint structure (authentication, task CRUD, task actions)
  - Request/response format specifications with examples
  - Status codes and error codes taxonomy
  - API documentation requirements (contracts/)
  - SQLModel code examples with Task IDs
  - Index and foreign key specifications
  - Pre-commit hook enforcement patterns
  - External context documentation patterns
  - Comprehensive deliverables checklist (frontend, backend, spec, documentation)
  - Quality gates (testing, security, documentation, isolation)
  - Governance and compliance procedures
  - Amendment versioning policy (MAJOR/MINOR/PATCH)

**File Paths & Dependencies:**

- Constitution file: `.specify/memory/constitution.md` (v2.0.0)
- PHR: `history/prompts/constitution/2-phase2-constitution-expanded.constitution.prompt.md`
- Related templates verified compatible:
  - `.specify/templates/spec-template.md` ‚úÖ (user stories fit under Principle 7)
  - `.specify/templates/plan-template.md` ‚úÖ (Constitution Check section aligns with Principles 1-12)
  - `.specify/templates/tasks-template.md` ‚úÖ (task phases align with Workflow Enforcement)

**Key Decisions Encoded:**

1. **Spec-First is Non-Negotiable**: Every line of code must have Task ID comment; no manual commits
2. **5-Phase Evolution**: Phase 2 is the second phase; architecture must support Phases 3-5
3. **JWT + Better Auth**: Immutable choice for authentication; BETTER_AUTH_SECRET shared between frontend/backend
4. **User Data Isolation**: Every query must include user_id filter; 403 Forbidden on mismatch (not 404)
5. **70% Test Coverage**: Minimum enforced via pre-commit hooks; no exceptions
6. **Stateless Backend**: No session state; all state in Neon PostgreSQL
7. **Monorepo with CLAUDE.md Guardians**: Three CLAUDE.md files (root, frontend, backend) guide Claude Code locally
8. **context7 MCP for Docs**: Framework documentation fetched from MCP, not internal knowledge

**Validation & Compliance:**

- ‚úÖ No unexplained bracket tokens
- ‚úÖ Version 2.0.0 matches Sync Impact Report (MAJOR bump justified)
- ‚úÖ All dates in ISO format (2026-02-01)
- ‚úÖ All principles declarative, testable, free of vague "should" language
- ‚úÖ Deliverables checklist is comprehensive and measurable
- ‚úÖ Pre-release quality gates are enforceable
- ‚úÖ Governance procedures defined (amendment, versioning, compliance review)

## Outcome

- ‚úÖ Impact: Constitution v2.0.0 is ratified as binding system law for Phase 2 development. All 12 principles are concrete, enforceable, and enable Claude Code to generate all Phase 2 code without manual intervention. Foundation ready for /sp.specify to create authentication and task-management specs.
- üß™ Tests: N/A (constitution is governance artifact, not executable code)
- üìÅ Files: `.specify/memory/constitution.md` (created, v2.0.0)
- üîÅ Next prompts: `/sp.specify authentication` to create authentication spec; `/sp.specify task-management` to create task management spec; then `/sp.plan`, `/sp.tasks`, and `/sp.implement` in sequence
- üß† Reflection: User provided comprehensive, detailed principles aligned with hackathon constraints and spec-driven development ethos. Constitution is now the single source of truth for Phase 2 governance. All downstream specs, plans, and tasks must align with this constitution.

## Evaluation notes (flywheel)

- Failure modes observed: None; constitution is comprehensive and self-contained
- Graders run and results (PASS/FAIL): PASS (all 12 principles concrete, all deliverables checklist items measurable, all governance procedures defined, no unresolved placeholders)
- Prompt variant (if applicable): null
- Next experiment (smallest change to try): Extend constitution with Phase 3 principles (AI Chatbot) when Phase 2 is ready for next evolution; constitution versioning ensures rollback is possible

